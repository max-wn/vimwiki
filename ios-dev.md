## как выложить приложение в App Store

### Готовимся к релизу в App Store. Инструкция и лайфхаки

[Source][001]

Готовимся к публикации. В среднем процесс занимает пару недель. Шаги:
1. Создаем **AppleID** (10 минут)
2. Регистрируем аккаунт разработчика (1день как разработчик\19 дней как
   компания, во всем виноват D-U-N-S number.)
3. Оплачиваем аккаунт (2-3 дня)
4. Готовим маркетинговые материалы (1 день)

#### Создаем **AppleID**

Если **AppleID** уже есть, переходим к шагу 2. Если нет, создаем.  Заходим на
сайт Apple. Нажимаем кнопку `Create Your AppleID`.  Открывается форма с
личными данными.  Корректно заполняем информацию о владельце аккаунта.
Отвечаем на три обязательных вопроса на случай утери пароля, без них не
создать аккаунт. Данные лучше куда-нибудь записать, чтобы не забыть вводную
информацию через несколько лет.  Соглашаемся с политикой конфиденциальности,
разгадываем капчу и нажимаем кнопку «Продолжить».  Появляется форма, в которую
нужно ввести код подтверждения. Он придет на почту, привязанную к аккаунту.
Есть 30 минут, чтобы ввести код. Иначе придется начинать все сначала.  Готово.
**AppleID** создан.

#### Регистрируем аккаунт разработчика

1. Заходим на сайт Apple. Вводим **AppleID** и пароль, которые у нас уже есть.
2. Соглашаемся с пользовательским соглашением. Нажимаем на кнопку `Submit`.
   Оказываемся на welcome-экране.
3. Нажимаем `Join the Apple Developer Program`. Переходим на следующий экран.
4. Наша цель — синяя кнопка `Enroll` в правом верхнем углу. Нажимаем её.
5. Теперь два пути: присоединиться к программе как физическое лицо
   (individual) или как юридическое (Company/Government Organization).
   Стоимость одинаковая — **99 долларов**, вне зависимости от типа разработчика.
   Отличие тоже одно — статусность. В графе «продавец» будет значиться либо
   Ivan Ivanov, либо Romashka, LCC. Если в приложении есть частичка
   интеллектуальной собственности, лучше перестраховаться и выложить от лица
   компании. Проще будет подготовить доказательную базу для Apple в случае
   споров.

Как разработчик:
* Выбираем `individual` и жмем кнопку `Continue`.
* На следующем экране предлагают заполнить персональную информацию.
* Ставим галку, что соглашаемся с условиями пользовательского соглашения. Жмем
  кнопку `Continue`.

Как компания:
* Если хотите зарегистрироваться как компания, вас ждут похожие поля. Чтобы
  пройти проверку Apple, нужно добыть **D-U-N-S** number организации.
* **D-U-N-S** можно добыть бесплатно на официальном сайте. Через 14 дней после
  получения номера информация окажется у Apple. Закладывайте минимум 19
  рабочих дней на ожидание. Обратите внимание, что название вашей компании на
  сайтах Apple и D&B должны полностью совпадать.

6. Оплачиваем аккаунт! Жмем кнопку `Purchase`. Заполняем информацию о
   плательщике. Стандартная покупка в интернете. Фамилия держателя карты
   должна совподать с фамилией владельца аккаунта. С карточки деньги списывают
   моментально, но оплата может проходить два дня.
7. Финальный штрих в истории — письмо с подтверждением, которое придет на
   почту. Как только пришло — порядок, можно выкладывать приложение.

#### Готовим маркетинговые материалы

Заранее готовим материалы, чтобы не терять время во время релиза.

* Название приложения. Будет отображаться в _App Store_. До 30 символов.
* Ключевые слова. Одно или несколько ключевых слов, описывающих приложение.
  Поиск в _App Store_ по ключевым словам дает более точные результаты.
  Разделяйте ключевые слова запятыми. До 100 символов.
* Описание. Описание приложения также будет использовано в приложении для
  Apple Watch. Максимум 4000 символов.
* E-mail службы поддержки. В формате `support@example.org`.
* Имя разработчика
* Категория. Нужно выбрать меньшее из зол. Бизнес, Газеты и журналы, Дети,
  Еда и напитки, Здоровье и фитнес, Игры, Каталоги, Книги, Медицина, Музыка,
  Навигация, Новости, Образ жизни, Образование, Погода, Покупки,
  Производительность, Путешествия, Развлечения, Социальные сети, Спорт,
  Справочники, Утилиты, Финансы, Фото и видео.
* Номер версии. Номер версии приложения.
* URL-адрес рекламного сайта. URL-адрес с рекламной информацией о приложении.
  Будет отображаться в _App Store_.
* Политика конфиденциальности. Если приложение собирает данные пользователей,
  нужна ссылка на политику конфиденциальности.
* Снимки экрана. Снимки экрана должны быть в формате `JPG` или `PNG` и
  цветовом пространстве `RGB`. Не более пяти снимков для каждого типа
  устройства. Типов устройств четыре: **iPhone 4, 5, 6, 6plus**. С подробной
  информацией о требованиях к графическим данным можно ознакомиться на сайте
  Apple. Видео о приложении — по желанию. Требования: формат `M4V`, `MP4`
  или `MOV`. Не более `500 MB`.
* Иконка. В формате `JPG` или `PNG`, в цветовом пространстве `RGB` и с
  разрешением не менее 72 точек на дюйм. Никаких закругленных углов, Apple
  сам все сделает. Разрешение `1024 x 1024` пикселей.
* Авторские права. Имя лица или название организации, которые владеют
  уникальными правами на приложение. Указывается после года получения прав
  (если применимо). Например, «2008 ИП Иванов И.И.».
* URL-адрес службы поддержки. URL-адрес службы поддержки приложения. Будет
  отображаться в _App Store_.
* Контактная информация. Сотрудник вашей организации, с которым можно
  связаться в случае возникновения вопросов при публикации. Укажите имя,
  почту, номер телефона сотрудника.
* Примечания. Дополнительная информация о приложении, которая может помочь
  при проверке. До 4000 символов.
* Пользовательское соглашение. Если отличается от эпловского.
* Что нового. Предоставьте информацию о том, что нового в этой сборке и что
  необходимо протестировать. До 3 600 символов.
* Возрастной лимит. Если есть.
* Демонстрационная учетная запись. Предоставьте имя пользователя и пароль
  для учетной записи с полным доступом. Если Apple не сможет залогиниться в
  приложении для проверки, то отклонит его. Если предусмотрена авторизация
  через смс, обязательно предоставьте номер телефона для Apple, на который
  компания может позвонить и запросить код подтверждения для входа в
  приложение.
* Описание приложения. Для бета-тестирования. Должно отражать функции и
  возможности приложения. До 6 000 символов.
* Рекламный текст. Появится над описанием в _App Store_. Будет отображаться
  для пользователей устройств с iOS 11 и новее. До 170 символов.
* Подзаголовок. Краткое описание приложения, которое появится под его
  названием в _App Store_. До 30 символов.
* Значок для _App Store_ для Apple Watch. Для приложений, собранных с помощью
  Xcode 9 и новее, значок должен быть включен в сборку.
* Снимки экрана Apple Watch. Снимки экрана должны иметь формат `JPG` или `PNG`
  (цветовое пространство `RGB`) `312 x 390 pixels`.

### Выкладываем приложение в App Store.

[Source][002]

Для того чтобы выложить приложение в _App Store_, потребуется оплаченный аккаунт
разработчика, среда разработки XCode и исходный код вашего приложения. Шаги:
1. Настройка аккаунта
2. Оформление приложения для магазина
3. Настройка проекта, сборка и выгрузка
4. Отправка на ревью

#### Настройка аккаунта

Все приложения перед выгрузкой в _App Store_ должны быть подписаны сертификатом
разработчика. Это нужно, чтобы пользователи _App Store_ были уверены, что
скачивают конкретное приложение от конкретного разработчика, а не подделку от
чужого имени. Процедура подписывания (code signing) приложения позволяет
операционной системе узнать, кто является разработчиком. И удостовериться в
том, что приложение не было изменено с момента сборки. Точнее, с того момента,
как разработчик его подписал. В этой процедуре участвуют три объекта:
**сертификат разработчика**, **AppID** и **Provisioning profile**.

**Сертификат разработчика** представляет собой пару ключей асимметричного шифрования:
приватный и публичный. В процессе сборки `XCode` формирует цифровую подпись
для сборки на основании данных приватного ключа. Проверить подпись можно с
помощью публичного ключа, который доступен и для Apple, который этот
сертификат выдала. Одного сертификата достаточно для выкладки неограниченного
количества приложений.

Чтобы создать сертификат, нужно:
1. Перейти на [apple developer](https://developer.apple.com)
2. перейти в раздел `сертификаты`, нажать на `плюсик` Выбрать тип сертификата
   `Production — _App Store_ and Ad Hoc`
3. Следуя приведенным инструкциям сформировать `Certificate request` и
   загрузить его на портал
4. Сохраните сгенерированный сертификат на компьютер, откройте его (дважды
   кликнув). Сертификат будет помещен в системное хранилище и доступен для
   `XCode`.

**AppID** Это уникальный строковый идентификатор приложения среди всех
приложений. Он нужен для однозначной идентификации во всех системах: _iTunes
Connect_, _App Store_ и пр. Он состоит из двух частей: **TeamID** и
**BundleID**.

- **TeamID** — идентификатор разработчика, выдается Apple на этапе регистрации
  аккаунта разработчика и не меняется.
- **BundleID** задается разработчиком при регистрации приложения в аккаунте.

Чтобы создать **AppID**, нужно:

1. Перейдите в раздел
   [AppIDs](https://developer.apple.com/account/ios/identifier/bundle),
   нажмите на плюсик справа вверху
2. Заполните поле `App ID Description` — условное наименование приложения для
   разработчика, не видимое в _App Store_, например `TestApplication`
3. Заполните поле `Explicit App ID` — тот самый **BundleID**, например
   `ru.myStartup.testApplication`
4. В разделе `App Services` подключите те сервисы, которые понадобились в
   процессе разработки приложения. Если вы не понимаете, о чем речь — оставьте
   как есть.


**Provisioning profile** Это профиль, который однозначно связывает **AppID** и
**сертификат разработчика** (публичный ключ сертификата). В случае development
provisioning profile он также содержит UDID всех устройств, на которых
возможен запуск приложения.

Создадим **Provisioning profile**:

1. Перейдите в раздел [iOS Provisioning
   Profiles](https://developer.apple.com/account/ios/profile/), нажмите на
   плюсик справа вверху Тип профайла — `App Store`
2. Затем необходимо указать **AppID**, для которого создается профайл —
   укажите раннее созданный **AppID**
3. Следующий шаг — выбор сертификата. Отметьте галочкой сертификат, который мы
   создали ранее
4. Последним шагом необходимо дать наименование профайлу, например,
   `TestApplicationStoreProfile`

Сохраните сгенерированный профайл на компьютер, откройте его, дважды кликнув.
Теперь сертификат доступен для `XCode`.

#### Оформление приложения для магазина

Теперь нужно добавить приложение в _iTunes Connect_.
Переходим на [interconnect](https://itunesconnect.apple.com) в раздел
`MyApps`. Чтобы добавить приложение, нажмите плюсик слева вверху. Заполняем
открывшуюся форму:
1. Указываем платформу — `iOS`
2. Наименование приложения, будет отображаться в _App Store_. До 30 знаков.
3. Основной язык приложения
4. Выберите из выпадающего списка AppID приложения
5. `SKU` — уникальный идентификатор для финансовых отчетов и аналитики. Можно
   сделать таким же как **BundleID** выше

Если все заполнено правильно, попадаем на страницу приложения. На вкладке
слева `Pricing and Availability` заполняем информацию о стоимости приложения в
сторе. На вкладке слева с номером версии заполняем маркетинговую информацию:
1. видео-превью и скриншоты для различных устройств
2. ключевые слова для поиска в магазине
3. описание
4. возрастной рейтинг
5. наименование правообладателя
6. контактную информацию, на случай, если у ревьюера появятся вопросы.

О том, как подготовить маркетинговую информацию, см. выше.

Также есть секция для того, чтобы можно было указать конкретную сборку,
которую отправлять на ревью, а затем и в стор. Выбор недоступен до тех пор,
пока мы не загрузили в _iTunes Connect_ ни одной сборки приложения. Чтобы
сохранить внесенные изменения, используйте кнопку `Save` наверху.

#### Настройка проекта, сборка и выгрузка

Откройте проект вашего приложения в `XCode`, перейдите к настройкам проекта.
Необходимо, чтобы **Bundle Identifier** совпадал с **BundleID**, который вы
указали при создании **AppID**. Также необходимо отключить функцию
автоматического управления подписыванием в `XCode`. В выпадающем списке
`Provisioning Profile` выберите тот, который недавно создали.

Обратите внимание: без всех необходимых иконок (в том числе иконка для
магазина со стороной 1024 точки) сборка приложения не пройдет автоматическую
проверку в _iTunes Connect_.

Теперь проект можно собрать и отправить в _iTunes Connect_. Для этого нужно
нажать меню `Product — Archive`. По итогу сборки будет показано окно
органайзера `XCode`, нажмите там кнопку `Upload To App Store`:

Открывается окно настроек выгрузки в _App Store_. Подробнее про
[bitcode](https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/AppThinning/AppThinning.html),
[symbols
stripping](https://developer.apple.com/library/content/releasenotes/DeveloperTools/RN-Xcode/Chapters/Introduction.html).
Оставляем настройки без изменений.

На следующем шаге нужно выбрать `provisioning profile` из выпадающего списка
подходящих

Затем `XCode` подготовит архив для выгрузки в _iTunes Connect_. На этом экране
обратите внимание на те параметры, что мы установили. Нажмите `Upload`.

В зависимости от скорости соединения нужно будет подождать некоторое время.
Если все в порядке, `XCode` сообщит об успешном завершении выгрузки в _iTunes
Connect_. Можно переходить к последнему этапу.

#### Отправка на ревью

В _iTunes Connect_ на вкладке `Activity` можно увидеть отправленную сборку.
Для проектов на `Swift` автоматическая проверка сборки занимает примерно
полчаса. До тех пор сборка будет со статусом `Processing`. После окончания
проверки сборка доступна для выбора на странице информации о версии
приложения.

Выбираем сборку. После этого у приложения в _iTunes Connect_ появится иконка.
Сохраните изменения. Теперь можно отправить сборку на ревью.

Готово! Ждите ответа в течение нескольких дней. Не забудьте, что с 23 по 27
декабря _iTunes Connect_ на каникулах. Разработчики не смогут обновлять и
добавлять новые приложения в _App Store_ и изменять ценники. Все остальные
функции _iTunes Connect_ будут доступны.

---

THE END

[001]: https://habr.com/ru/company/touchinstinct/blog/341858/ "prepare for release"
[002]: https://habr.com/ru/company/touchinstinct/blog/345336/ "upload app"
